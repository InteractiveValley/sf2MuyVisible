{% extends "FrontendBundle::layout.html.twig" %}

{% set urlAbsoluta = 'http://' ~ app.request.server.get('SERVER_NAME') %}

{% if publicacion.image | length > 0 %}
    {% set urlAbsolutaFoto = (publicacion.webPath | imagine_filter('image_social') ) %}
{% else %}
    {% set urlAbsolutaFoto = urlAbsoluta ~ asset('images/logo.png') %}
{% endif %}
                                
{% block redes_sociales %}
    <meta name="description" content="{{publicacion.resume | striptags | truncate(189,true,'...') | raw}}" />
    <link rel="canonical" href="{{url('publicacion',{'slug':publicacion.slug})}}" />

    
    <meta property="fb:app_id" content="1461130887533217">
    <meta property="og:type" content="article" />
    <meta property="og:url" content="{{url('publicacion',{'slug':publicacion.slug})}}" />
    <meta property="og:title" content="{{publicacion.title}}" />
    <meta property="og:image" content="{{ urlAbsolutaFoto }}" />
    <meta property="og:description" content="{{publicacion.resume | striptags | truncate(189,true,'...') | raw}}" />
    <meta property="og:locale" content="es_ES" />
    <meta property="og:site_name" content="Muy Visible" />
    
    
    <!--meta property="fb:admins" content="100000062710915"-->
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="{{publicacion.title}}" />
    <meta name="twitter:description" content="{{publicacion.resume|striptags}}" />
    <meta name="twitter:url" content="{{url('publicacion',{'slug':publicacion.slug})}}" />
    <meta name="twitter:site" content="@MuyVisible" />
    <meta name="twitter:image:src" content="{{ urlAbsolutaFoto }}" />
    <meta name="twitter:domain" content="muyvisible.com" />
    
    
    <meta itemprop="name" content="{{publicacion.title}}" />
    <meta itemprop="description" content="{{publicacion.resume|striptags}}" />
    <meta itemprop="image" content="{{ urlAbsolutaFoto }}" />
    
    
    <meta name="pubexchange:headline" content="{{publicacion.title}}" />
    <meta name="pubexchange:description" content="{{publicacion.resume|striptags}}" />
    <meta name="pubexchange:image" content="{{ urlAbsolutaFoto }}" />
{% endblock %}    

{% block class_body ' class="noticias"' %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" media="screen" href="{{asset('css/muyvisible/publicacion.css')}}"/>
    <link rel="stylesheet" href="{{asset('css/modal.css')}}"/>
    {% if app.environment == 'prod' %}
        <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-63720003-1', 'auto');
        ga('send', 'pageview');

      </script>
    {% endif %}
{% endblock %}

{% block body %}
    <div id="fb-root"></div>
        <script>
        window.fbAsyncInit = function() {
          FB.init({
            appId      : '1461130887533217',
            xfbml      : true,
            version    : 'v2.3'
          });
        };

        (function(d, s, id){
           var js, fjs = d.getElementsByTagName(s)[0];
           if (d.getElementById(id)) {return;}
           js = d.createElement(s); js.id = id;
           js.src = "//connect.facebook.net/es_ES/sdk.js";
           fjs.parentNode.insertBefore(js, fjs);
         }(document, 'script', 'facebook-jssdk'));
    </script>
    <!--[if lt IE 7]>
            <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
        <![endif]-->
    {% if publicacion.image | length > 0 %}
        <header class="head_noticias">
            <div class="publicidad_head"><img src="http://placehold.it/731x92/2A2A2A/2A2A2A" alt=""></div>
            <figure><a href="{{path('homepage')}}"><img src="/images/muyvisible_mini_logo.png" alt=""></a></figure>
        </header>
        <section>
            <figure class="img_cabezera">
                <img src="{{publicacion.webPath}}" alt="">
            </figure>
        </section>
    {% else %}
        <header class="head_noticias no-fixed">
            <div class="publicidad_head"><img src="http://placehold.it/731x92/2A2A2A/2A2A2A" alt=""></div>
            <figure><a href="{{path('homepage')}}"><img src="/images/muyvisible_mini_logo.png" alt=""></a></figure>
        </header>
        <div class="sin-portada"></div>   
    {% endif  %}
    <section class="cuerpo">
        <div class="main-wrapper">
        <section class="central">
            <article class="publicacion">
                <header class="titulo">
                    <h1>{{publicacion.title}}</h1>
                    <p class="resumen">{{publicacion.resume | raw}}</p>
                    <div class="contador">
                        <table>
                            <tr class="numero">
                                <td class="count-likes">{{shareFacebook}}</td>
                                <td class="count-tweets">{{shareTwitter}}</td>
                                <!--td class="count-plus">0</td-->
                                <td class="count-views">{{publicacion.contViews}}</td>
                            </tr>
                            <tr class="comentarios">
                                <td>FACEBOOK</td>
                                <td>TWEETS</td>
                                <!--td>PLUS</td-->
                                <td>VIEWS</td>
                            </tr>
                        </table>
                    </div>
                </header>
                <div class="contenido-publicacion">
                    {{ publicacion.description | raw }}
                </div>
                <footer>
                    <div class="info">
                        <div class="referencia">{{ ( publicacion.referencia|length>0)? 'Fuente/Referencia: '~ publicacion.referencia :'' }}</div>
                        <div class="fecha">{{ publicacion.createdAt | translate_date }} | {{ publicacion.createdAt|date("G:i A") }}</div>
                    </div>
                    <div class="sociales">
                        {% set urlPagina = url('publicacion',{'slug':publicacion.slug}) %}
                        {% set title = publicacion.title %}
                        {% set via = ' @MuyVisible' %}
                        <span class="share">COMPARTIR</span><br>
                        <div class="flex-container">
                            <a class="flex-a facebook  js-social-button" href="http://www.facebook.com/sharer.php?u={{urlPagina}}&display=popup" data-popup-width="555" data-popup-height="370"><span class="flaticon-facebook"></span>&nbsp;FACEBOOK</a>
                            <a class="flex-a twitter  js-social-button" href="http://twitter.com/share?url=/&text={{title ~' ' ~ urlPagina ~ ' ' ~ via | url_encode }}"  data-popup-width="555" data-popup-height="395"><span class="flaticon-twitter"></span>&nbsp;TWITTER</a>
                            <a class="flex-a shares open-modal-social" href="#"><span class="flaticon-share"></span>&nbsp;SHARE</a>
                        </div>
                    </div>
                    <div class="comentarios_face">
                        <div class="fb-comments" data-href="{{url('publicacion',{'slug':publicacion.slug})}}" data-numposts="5" data-width="100%"></div>
                    </div>
                </footer>
            </article>
        </section>
        <aside class="derecha">
            <div class="derecha_2">
                <div class="publicidad_der"><img style="width:300px;" src="http://placehold.it/300x250/ffffff/ffffff" alt=""></div>
                <div class="sociales_2">
                    <span class="share">COMPARTIR</span>
                    <a class="red-social facebook  js-social-button" href="http://www.facebook.com/sharer.php?u={{urlPagina}}&display=popup" data-popup-width="555" data-popup-height="370">
                        <span class="icon flaticon-facebook"></span>&nbsp;FACEBOOK
                    </a>
                    <a class="red-social twitter  js-social-button" href="http://twitter.com/share?url=/&text={{title ~' ' ~ urlPagina ~ ' ' ~ via | url_encode }}" data-popup-width="555" data-popup-height="395">
                        <span class="icon flaticon-twitter"></span>&nbsp;TWITTER
                    </a>
                    <a class="red-social shares open-modal-social" href="#">
                        <span class="icon flaticon-share"></span>&nbsp;SHARE
                    </a>
                </div>
                <div class="sociales_2 compartir-url">
                    <span class="share">VINCULO DE PUBLICACION</span>
                    <div class="group-url-publicacion">
                        <input id="url_publicacion" class="url-publicacion" type="text" value="{{url('publicacion',{'slug':publicacion.slug})}}">
                        <a  class="copy botonCopiarUrlPublicacion" href="#">COPIAR</a>
                    </div>
                </div>
                 <div class="sociales_2 compartir-url margin-top">
                     <a href="https://www.facebook.com/pages/Muy-Visible/684809468330914" target="_blank">
                        <div class="mas_notas">
                            <img src="/images/lentes.png" alt="">
                            Ver m√°s NOTAS
                        </div>
                    </a>
                </div>
            </div>
        </aside>
        </div>
    </section>

    <footer></footer>
    
    <div id="dialog-modal" class="bgmodal" style=" display: none;">
            <ul class="list-redes-sociales">
                <li class="item-red-social active">
                    <a class="googleplus button js-social-button js-social-button-service" href="https://plus.google.com/share?url={{url('publicacion',{'slug':publicacion.slug})}}" data-social-slug="googleplus" data-popup-width="480" data-popup-height="665">
                        <span class="icon flaticon-googleplus"></span>
                    </a>
                </li>
                <li class="item-red-social">
                    <a class="facebook button js-social-button js-social-button-service" href="http://www.facebook.com/sharer.php?u={{urlPagina|url_encode}}&display=popup" data-social-slug="facebook" data-popup-width="555" data-popup-height="370">
                        <span class="icon flaticon-facebook"></span>
                    </a>
                </li>
                <li class="item-red-social">
                    <a class="twitter button js-social-button js-social-button-service" href="http://twitter.com/share?url=/&text={{title ~' ' ~ urlPagina ~ ' ' ~ via | url_encode }}" data-social-slug="twitter" data-popup-width="555" data-popup-height="395">
                        <span class="icon flaticon-twitter"></span>
                    </a>
                </li>
                <li class="item-red-social">
                    <a class="linkedin button js-social-button js-social-button-service" href="http://www.linkedin.com/shareArticle?mini=true&url={{urlPagina|url_encode}}&amp;media={{title|url_encode}}" data-social-slug="linkedin" data-popup-width="600" data-popup-height="465">
                        <span class="icon flaticon-linkedin"></span>
                    </a>
                </li>
                <li class="item-red-social">
                    <a class="pinterest button js-social-button js-social-button-service" href="http://www.pinterest.com/pin/create/button/?url={{urlPagina|url_encode}}&description={{title|url_encode}}&media={{ urlAbsolutaFoto | url_encode}}" data-social-slug="pinterest" data-popup-width="750" data-popup-height="316">
                        <span class="icon flaticon-pinterest"></span>
                    </a>
                </li>
                <li class="item-red-social">
                    <a class="stumbleupon button js-social-button js-social-button-service" href="http://www.stumbleupon.com/submit?url={{urlPagina|url_encode}}&title={{title|url_encode}}" data-social-slug="stumbleupon" data-popup-width="980" data-popup-height="575">
                        <span class="icon flaticon-stumbleupon"></span>
                    </a>
                </li>
                <li class="item-red-social">
                    <a class="reddit button js-social-button js-social-button-service" href="http://www.reddit.com/submit?url={{urlPagina|url_encode}}&title={{title|url_encode}}" data-social-slug="reddit" data-popup-width="980" data-popup-height="750">
                        <span class="icon flaticon-reddit"></span>
                    </a>
                </li>
                <li class="item-red-social">
                    <a class="email button js-social-button js-social-button-email" href="mailto:?body={{title|url_encode}}.%0A%0A{{urlPagina}}." data-social-slug="email" data-popup-width="500" data-popup-height="400">
                        <span class="icon flaticon-arroba"></span>
                    </a>
                </li>
            </ul>
            <a href="#" class="close-modal"><span class="icon flaticon-close" style="font-size:10px;"></span></a>
        </div>
    
    {% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{asset('js/jquery.modal-social.js')}}"></script>
    <script>
        var openModal = false;
        $(function () {
            $(window).scroll(function () {
                if ($(window).scrollTop() > 620){
                    $(".head_noticias").fadeOut();
                }else{
                    $(".head_noticias").fadeIn();
                }
                if ($(window).scrollTop() > 715){
                    $(".derecha_2").addClass('fijo');
                }else{
                    $(".derecha_2").removeClass('fijo');
                }
                posicionarMenu();
            });
            
            $('.js-social-button').on('click',function(e){
               e.preventDefault();
               e.stopPropagation();
               if(openModal){
                   closeModalSocial();
               }
               var url = $(this).attr('href');
               var width = $(this).data('popup-width');
               var height = $(this).data('popup-height');
               window.open(url,'','width='+width+',height='+height+',left=50,top=50,toolbar=yes');
               return false;
            });
            var anchoCentral = $(".central").width();
            /*setTimeout(function(){
                if(anchoCentral>500){
                    $("iframe").css({'width': (anchoCentral-98)+'px'});
                }else{
                    $("iframe").css({'width': anchoCentral+'px'});
                }
            },2000);*/
            
            $(".botonCopiarUrlPublicacion").on("click",function(e){
               e.preventDefault();
               var urlPublicacion = document.getElementById("url_publicacion");
               urlPublicacion.select() 
               copy_clip(urlPublicacion.value);
            });
            
            $(".open-modal-social").on("click",function(){
                $().modalSocial();
                openModal = true;
            });
            
            $(".close-modal").on("click",function(e){
               e.preventDefault();
               closeModalSocial();
               openModal = false;
            });
            
            var $imagenes = $(".contenido-publicacion img");
            var contador = 1;
            $imagenes.each(function(index,imagen){
               var figure = $("<figure/>");
               var img = $("<img/>");
               figure.append(img);
               img.attr({'src':$(imagen).attr('src'),'id': 'imagen-'+contador});
               $(imagen).before(figure);
               contador++;
               $(imagen).remove();
            });
            
            posicionarMenu();
        });
        function posicionarMenu() {
            var altura_del_header = $('.head_noticias').outerHeight(true);
            var altura_del_menu = $('.head_noticias').outerHeight(true);

            if ($(window).scrollTop() >= 0){
                $('.head_noticias').addClass('fixed');
                $('.img_cabezera').css('margin-top', (altura_del_menu) + 'px');
            } else {
                $('.head_noticias').removeClass('fixed');
                $('.img_cabezera').css('margin-top', '0');
            }
        }
        
        function copy_clip(meintext) 
        { 
        if (window.clipboardData) 
            { 

            // the IE-manier 
           window.clipboardData.setData("Text", meintext); 

           // waarschijnlijk niet de beste manier om Moz/NS te detecteren; 
           // het is mij echter onbekend vanaf welke versie dit precies werkt: 
           } 
           else if (window.netscape) 
           { 

           // dit is belangrijk maar staat nergens duidelijk vermeld: 
           // you have to sign the code to enable this, or see notes below 
           netscape.security.PrivilegeManager.enablePrivilege('UniversalXPConnect'); 

           // maak een interface naar het clipboard 
           var clip = Components.classes['@mozilla.org/widget/clipboard;1'] 
               .createInstance(Components.interfaces.nsIClipboard); 
           if (!clip) return; 

           // maak een transferable 
           var trans = Components.classes['@mozilla.org/widget/transferable;1'] 
               .createInstance(Components.interfaces.nsITransferable); 
           if (!trans) return; 

           // specificeer wat voor soort data we op willen halen; text in dit geval 
           trans.addDataFlavor('text/unicode'); 

           // om de data uit de transferable te halen hebben we 2 nieuwe objecten 
           // nodig om het in op te slaan 
           var str = new Object(); 
           var len = new Object(); 

           var str = Components.classes["@mozilla.org/supports-string;1"] 
               .createInstance(Components.interfaces.nsISupportsString); 

           var copytext=meintext; 

           str.data=copytext; 

           trans.setTransferData("text/unicode",str,copytext.length*2); 

           var clipid=Components.interfaces.nsIClipboard; 

           if (!clip) return false; 

           clip.setData(trans,null,clipid.kGlobalClipboard); 

           } 
           alert("Following info was copied to your clipboard:\n\n" + meintext); 
           return false; 
        } 
    </script>
{% endblock %}
